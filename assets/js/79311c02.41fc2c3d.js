"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[1142],{2085:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>o,toc:()=>d});var i=n(5893),r=n(1151);const t={},a="Gestion des vLANS sous PVE avec OPNsense",o={id:"Networks/Firewall/OPNsense/opnsensevlanpve",title:"Gestion des vLANS sous PVE avec OPNsense",description:"Introduction & Pr\xe9requis",source:"@site/docs/Networks/Firewall/OPNsense/opnsensevlanpve.md",sourceDirName:"Networks/Firewall/OPNsense",slug:"/Networks/Firewall/OPNsense/opnsensevlanpve",permalink:"/Portfolio/docs/Networks/Firewall/OPNsense/opnsensevlanpve",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Installation de OPNsense sur VM (PVE)",permalink:"/Portfolio/docs/Networks/Firewall/OPNsense/opnsense-01"},next:{title:"Cisco CLI Reference, Howtos, and Tools",permalink:"/Portfolio/docs/Networks/Cisco/CiscoCLI"}},l={},d=[{value:"Introduction &amp; Pr\xe9requis",id:"introduction--pr\xe9requis",level:2},{value:"Pr\xe9requis",id:"pr\xe9requis",level:3},{value:"Cr\xe9ation des VLANS dans Proxmox",id:"cr\xe9ation-des-vlans-dans-proxmox",level:2},{value:"Ajouts des VLANS comme Interfaces dans OPNsense",id:"ajouts-des-vlans-comme-interfaces-dans-opnsense",level:2},{value:"Ajouts des VM dans les VLANS",id:"ajouts-des-vm-dans-les-vlans",level:2},{value:"Gestion des flux inter-vlans",id:"gestion-des-flux-inter-vlans",level:2},{value:"R\xe9sultat",id:"r\xe9sultat",level:2}];function c(e){const s={a:"a",admonition:"admonition",br:"br",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h1,{id:"gestion-des-vlans-sous-pve-avec-opnsense",children:"Gestion des vLANS sous PVE avec OPNsense"}),"\n",(0,i.jsx)(s.h2,{id:"introduction--pr\xe9requis",children:"Introduction & Pr\xe9requis"}),"\n",(0,i.jsxs)(s.p,{children:["Avant tout chose je tient \xe0 pr\xe9ciser que ce guide est la version \xe9crite de la vid\xe9o ",(0,i.jsx)(s.strong,{children:"Optimisez votre R\xe9seau : D\xe9ploiement de VLANs sur Proxmox avec OPNsense !"})," publi\xe9 sur ma ch\xe2ine YouTube @LouisIT443 le 1er Mars 2024. Je vous invite donc d'abord \xe0 consulter cette vid\xe9o avant de vous lancer dans ce guide."]}),"\n",(0,i.jsx)(s.p,{children:"Dans ce guide nous verrons donc la mise en place et la gestion de VLANS qui sont en r\xe9alit\xe9s des r\xe9saux locaux virtualis\xe9 qui permettent avant tout de segmenter proprement vos r\xe9seaux. Ils permettent aussi de g\xe9rer les acc\xe8s internes \xe0 un ensembles de machines qui sont sous le m\xeame r\xe9seau."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"MiniatureYouTube",src:n(1496).Z+"",width:"1920",height:"1080"})}),"\n",(0,i.jsx)(s.admonition,{title:"Lien",type:"info",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Optimisez votre R\xe9seau : D\xe9ploiement de VLANs sur Proxmox avec OPNsense !"})," : ",(0,i.jsx)(s.a,{href:"https://youtu.be/UJU-JZ7vs4k",children:"https://youtu.be/UJU-JZ7vs4k"})]})}),"\n",(0,i.jsx)(s.h3,{id:"pr\xe9requis",children:"Pr\xe9requis"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Avoir une machine OPNsense fonctionnelle. ",(0,i.jsx)(s.a,{href:"/docs/Networks/Firewall/OPNsense/opnsense-01",children:"Voir Guide"})]}),"\n",(0,i.jsx)(s.li,{children:"Avoir plusieurs VMBR sur Proxmox (1 Pour les VLANS & 1 Pour L'Administration de OPNsense)"}),"\n",(0,i.jsx)(s.li,{children:"Avoir deux Machines aui minimum \xe0 placer dans diff\xe9rents VLANS pour effectuer des Tests"}),"\n",(0,i.jsxs)(s.li,{children:["Une Machine d'Administration pour g\xe9rer l'interface Web d'OPNsense ",(0,i.jsx)(s.em,{children:"(Ex : Windows 11 en RDP)"})]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"cr\xe9ation-des-vlans-dans-proxmox",children:"Cr\xe9ation des VLANS dans Proxmox"}),"\n",(0,i.jsxs)(s.p,{children:["Pour pouvoir taguer nos interfaces d'un VLANS sur nos VM il faut renseigner nos futurs VLANS \xe0 Proxmox.",(0,i.jsx)(s.br,{}),"\n","Pour se faire rendez vous sur l'interface Web de PVE et s\xe9l\xe9ctionner votre node (Serveur) pas Datacenter",(0,i.jsx)(s.br,{}),"\n","Dans ",(0,i.jsx)(s.strong,{children:"network"})," cr\xe9er deux Linux VLAN avec comme nom vlanXXX ",(0,i.jsxs)(s.em,{children:["(Ex ",":vlan100"," & vlan50)"]}),".",(0,i.jsx)(s.br,{}),"\n","Dans l'emplacement ",(0,i.jsx)(s.strong,{children:"Vlan raw device"})," renseignez alors le vmbr que vous avez choisi qui supportera vos VLANs."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"OPNsensevlanpvve01",src:n(5880).Z+"",width:"582",height:"290"})}),"\n",(0,i.jsxs)(s.p,{children:["R\xe9p\xe9tez cette \xe9tape autant de fois que vous voulez pour le nombre de VLANs d\xe9sir\xe9s.",(0,i.jsx)(s.br,{}),"\n","Dans mon cas que 2 VLANS. Le VLAN 100 & Le VLAN 50"]}),"\n",(0,i.jsx)(s.admonition,{title:"Astuce \ud83d\udca1",type:"tip",children:(0,i.jsxs)(s.p,{children:["Pour plus de clart\xe9 si vous disposer d'un menu networks d\xe9j\xe0 charg\xe9 utiliser alors l'emplacement ",(0,i.jsx)(s.strong,{children:"Comments"})," pour d\xe9finir explicitement le r\xf4le d'un vlan ou dune interface"]})}),"\n",(0,i.jsx)(s.h2,{id:"ajouts-des-vlans-comme-interfaces-dans-opnsense",children:"Ajouts des VLANS comme Interfaces dans OPNsense"}),"\n",(0,i.jsxs)(s.p,{children:["D\xe9sormais nous avons renseign\xe9 nos VLANS \xe0 PVE on va pouvoir les renseign\xe9s dans OPNsense.",(0,i.jsx)(s.br,{}),"\n","Mais avant de lancer votre machine assurez vous que avez ajoutez votre vmbr supportant les vlans \xe0 votre VM OPNsense. N'indiquez aucun Tag de VLANS"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"OPNsensevlanpvve02",src:n(8712).Z+"",width:"612",height:"297"})}),"\n",(0,i.jsx)(s.p,{children:"D\xe8s que vous avez lancer votre OPNsense utlisez maintenant votre machine d'administration pour joindre son interface Web."}),"\n",(0,i.jsx)(s.p,{children:"Puis dans la section Interfaces \xe0 gauche de votre \xe9cran s\xe9l\xe9ctionnez Other-Types puis VLAN."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"OPNsensevlanpvve03",src:n(9381).Z+"",width:"299",height:"653"})}),"\n",(0,i.jsx)(s.p,{children:"Ensuite sur cette interface de gestion des VLANS dans OPNsense utliser le petit bouton plus color\xe9 en orange \ud83d\udfe0 pour ajouter de nouveaux VLANS dans OPNsense."}),"\n",(0,i.jsx)(s.p,{children:"Voici l'interface d'ajout d'un vlan dans OPNsense."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.em,{children:"Device"})," : Renseigner le nom de votre vlan sous cette forme (vlanX.XXX)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.em,{children:"Parent"})," : Selectionnez l'interface supportant vos VLANS"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.em,{children:"VLAN Tag"})," : Le Num\xe9ro du VLAN."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.em,{children:"Description"})," : Une descrition explicite du r\xf4le de ce vlan."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"OPNsensevlanpvve04",src:n(2414).Z+"",width:"823",height:"382"})}),"\n",(0,i.jsx)(s.p,{children:"Ensuite r\xe9p\xe9ter cette \xe9tape en fonction du nombre de vlans que vous souhaitez cr\xe9er."}),"\n",(0,i.jsxs)(s.p,{children:["Maintenant il va falloir ajouter ces VLANS dans les intefaces de OPNsense pour cela rien de plus simple rendez vous dans la partie ",(0,i.jsx)(s.em,{children:"Assignments"})," de la cat\xe9gorie ",(0,i.jsx)(s.em,{children:"Interfaces"})," de OPNsense puis ajouter les comme nouvelles interface avec une description vos vlans."]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"OPNsensevlanpvve05",src:n(5720).Z+"",width:"800",height:"185"})}),"\n",(0,i.jsx)(s.p,{children:"Ensuite vos Interfaces/VLANS apparaissent sur le c\xf4t\xe9 gauche.\r\nS\xe9l\xe9ctionnez les et activez les puis atttribuer leurs une addresse IP qui sera la passerelle de vos machines de ce VLAN."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"OPNsensevlanpvve06",src:n(6860).Z+"",width:"1439",height:"306"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"OPNsensevlanpvve07",src:n(6307).Z+"",width:"783",height:"545"})}),"\n",(0,i.jsx)(s.h2,{id:"ajouts-des-vm-dans-les-vlans",children:"Ajouts des VM dans les VLANS"}),"\n",(0,i.jsxs)(s.p,{children:["Apr\xe8s avoir renseign\xe9 nos VLANS du c\xf4t\xe9s de PVE puis de OPNsense il va falloir les renseign\xe9s c\xf4t\xe9s Clientes pour nos VM.",(0,i.jsx)(s.br,{}),"\n","Pour cela allez sur la VM concern\xe9 et ajoutez la carte r\xe9seaux supportant vos VLANS puis renseignez dans la partie ",(0,i.jsx)(s.strong,{children:"VLAN Tag"})," le VLAN que vous voulez \"rejoindre\".\r\nEnsuite d\xe9marez votre VM et renseignez une adresse dans le VLAN et en passerelle l'IP de l'interface correspondant \xe0 votre VLAN."]}),"\n",(0,i.jsx)(s.p,{children:"Exemple pour une machine dans le VLAN 100"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"OPNsensevlanpvve08",src:n(35).Z+"",width:"275",height:"102"})}),"\n",(0,i.jsx)(s.h2,{id:"gestion-des-flux-inter-vlans",children:"Gestion des flux inter-vlans"}),"\n",(0,i.jsx)(s.p,{children:"On vient de voir comment mettre nos machines dans leurs VLANS respectif mais malheuresement elle ne peuvent pas se joindre entre elles. Avantageux dans certains cas cette isolation du r\xe9seau peut \xeatre probl\xe9matique."}),"\n",(0,i.jsxs)(s.p,{children:["Pour rem\xe9dier \xe0 \xe7a on utilise le principe de r\xeagles dans la cat\xe9gorie Firewall.",(0,i.jsx)(s.br,{}),"\n","Ces r\xeagles seront li\xe9s \xe0 nos VLANS/Interfaces respectives."]}),"\n",(0,i.jsxs)(s.p,{children:["Pour mettre en oeuvre ce principe on utlisera une r\xeagles dites ",(0,i.jsx)(s.em,{children:"Pass ALL"}),".\r\nCe qui signifie que tout est autoris\xe9 !"]}),"\n",(0,i.jsx)(s.p,{children:"On configure cette r\xeagle sur chaque VLAN."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"OPNsensevlanpvve09",src:n(1233).Z+"",width:"1457",height:"399"})}),"\n",(0,i.jsx)(s.p,{children:"D\xe9sormais on peut avec une machine du VLAN 50 pinger une machine du VLAN 100"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"OPNsensevlanpvve10",src:n(1041).Z+"",width:"762",height:"372"})}),"\n",(0,i.jsx)(s.p,{children:"& Inversement"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{alt:"OPNsensevlanpvve11",src:n(4988).Z+"",width:"820",height:"426"})}),"\n",(0,i.jsx)(s.h2,{id:"r\xe9sultat",children:"R\xe9sultat"}),"\n",(0,i.jsx)(s.admonition,{title:"Bien Jou\xe9 ! \u2714\ufe0f",type:"tip",children:(0,i.jsx)(s.p,{children:"F\xe9licitations !  Vous savez d\xe9sormais comment mettre en place des VLANs sur Proxmox et les administrer avec OPNsense. Ajoutez d'autres VLANs dans votre r\xe9seau et s\xe9curiser les \xe0 l'aide de OPNsense et de sa fonction de r\xeagles / Firewall."})}),"\n",(0,i.jsx)(s.admonition,{title:"Liens \ud83d\udd17",type:"info",children:(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://opnsense.org/",children:"https://opnsense.org/"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://pve.proxmox.com/wiki/Network_Configuration",children:"https://pve.proxmox.com/wiki/Network_Configuration"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://www.zenarmor.com/docs/network-security-tutorials/how-to-configure-vlan-on-opnsense",children:"https://www.zenarmor.com/docs/network-security-tutorials/how-to-configure-vlan-on-opnsense"})}),"\n"]})})]})}function u(e={}){const{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},5880:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/opnsensevlanpve01-378a8a0831fd8a2ec75118d0255fed12.png"},8712:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/opnsensevlanpve02-41e2ff63f41b11880286aa4e8ad3c5dd.png"},9381:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/opnsensevlanpve03-13bc4710136f08da7e3167b8df6b5004.png"},2414:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/opnsensevlanpve04-1f4c940b4a1f0008c25ce5afff53a6c8.png"},5720:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/opnsensevlanpve05-06274d14377b412df33e7b305dc9933c.png"},6860:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/opnsensevlanpve06-6e82b4c72aab153992c6fccb42a78762.png"},6307:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/opnsensevlanpve07-38ed79cdd21dfb1772c33d548dd52fe5.png"},35:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/opnsensevlanpve08-1d7eacb6032ef624fffb8fad3cd58ce4.png"},1233:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/opnsensevlanpve09-820ae6f3c000639eb7c4e8d8da72eb81.png"},1041:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/opnsensevlanpve10-a3aef27fabbebf4ae074df84831e0d20.png"},4988:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/opnsensevlanpve11-e06c57074c302c5efbdc09f95f3696d8.png"},1496:(e,s,n)=>{n.d(s,{Z:()=>i});const i=n.p+"assets/images/opnsensevlanpveshow-0a80e5d9e2a82176a239eaff5e84844f.png"},1151:(e,s,n)=>{n.d(s,{Z:()=>o,a:()=>a});var i=n(7294);const r={},t=i.createContext(r);function a(e){const s=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);